---
import Link from "@components/Link.astro";
import ThemeToggle from "@components/ThemeToggle.astro";
---

<div class="relative">
  <button
    id="hamburger-button"
    class="group flex h-8 w-8 items-center justify-center rounded-sm border border-black/15 bg-neutral-100 transition-colors duration-300 ease-in-out hover:bg-black/5 hover:text-black focus-visible:bg-black/5 focus-visible:text-black dark:border-white/20 dark:bg-neutral-900 dark:hover:bg-white/5 dark:hover:text-white dark:focus-visible:bg-white/5 dark:focus-visible:text-white md:hidden"
    aria-label="Menu"
    aria-expanded="false"
  >
    <svg
      class="h-4 w-4 transition-transform duration-300"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        id="hamburger-top"
        class="origin-center transition-all duration-300"
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M4 6h16"
      ></path>
      <path
        id="hamburger-middle"
        class="origin-center transition-all duration-300"
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M4 12h16"
      ></path>
      <path
        id="hamburger-bottom"
        class="origin-center transition-all duration-300"
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M4 18h16"
      ></path>
    </svg>
  </button>

  <div
    id="mobile-menu"
    class="absolute right-0 top-full mt-2 w-48 rounded-lg border border-black/15 bg-neutral-100 p-4 shadow-lg dark:border-white/20 dark:bg-neutral-900 transition-all duration-300 ease-out opacity-0 scale-95 -translate-y-2 pointer-events-none"
  >
    <nav class="flex flex-col gap-4 text-sm">
      <Link href="/archive" underline={false}>archive</Link>
      <Link href="/calendar" underline={false}>calendar</Link>
      <Link href="/about" underline={false}>about</Link>
      <button
        id="mobile-search"
        aria-label="Search"
        class="flex size-8 items-center justify-center rounded-sm border border-black/15 bg-neutral-100 transition-colors duration-300 ease-in-out hover:bg-black/5 hover:text-black focus-visible:bg-black/5 focus-visible:text-black dark:border-white/20 dark:bg-neutral-900 dark:hover:bg-white/5 dark:hover:text-white dark:focus-visible:bg-white/5 dark:focus-visible:text-white"
      >
        <svg
          height="16"
          width="16"
          stroke-linejoin="round"
          viewBox="0 0 16 16"
          style="color: currentcolor;"
        >
          <path
            fill-rule="evenodd"
            clip-rule="evenodd"
            d="M3.5 7C3.5 5.067 5.067 3.5 7 3.5C8.933 3.5 10.5 5.067 10.5 7C10.5 7.88461 10.1718 8.69256 9.63058 9.30876L9.30876 9.63058C8.69256 10.1718 7.88461 10.5 7 10.5C5.067 10.5 3.5 8.933 3.5 7ZM9.96544 11.0261C9.13578 11.6382 8.11014 12 7 12C4.23858 12 2 9.76142 2 7C2 4.23858 4.23858 2 7 2C9.76142 2 12 4.23858 12 7C12 8.11014 11.6382 9.13578 11.0261 9.96544L14.0303 12.9697L14.5607 13.5L13.5 14.5607L12.9697 14.0303L9.96544 11.0261Z"
            fill="currentColor"
          ></path>
        </svg>
      </button>
      <ThemeToggle />
    </nav>
  </div>
</div>

<script>
  const hamburgerButton = document.getElementById("hamburger-button");
  const mobileMenu = document.getElementById("mobile-menu");
  const mobileSearch = document.getElementById("mobile-search");
  const hamburgerTop = document.getElementById("hamburger-top");
  const hamburgerMiddle = document.getElementById("hamburger-middle");
  const hamburgerBottom = document.getElementById("hamburger-bottom");

  let isOpen = false;

  function openMenu() {
    isOpen = true;
    hamburgerButton?.setAttribute("aria-expanded", "true");
    mobileMenu?.classList.remove("opacity-0", "scale-95", "-translate-y-2", "pointer-events-none");
    mobileMenu?.classList.add("opacity-100", "scale-100", "translate-y-0", "pointer-events-auto");
    // Animate hamburger to X
    hamburgerTop?.setAttribute("d", "M6 6l12 12");
    hamburgerMiddle?.classList.add("opacity-0");
    hamburgerBottom?.setAttribute("d", "M6 18L18 6");
  }

  function closeMenu() {
    isOpen = false;
    hamburgerButton?.setAttribute("aria-expanded", "false");
    mobileMenu?.classList.add("opacity-0", "scale-95", "-translate-y-2", "pointer-events-none");
    mobileMenu?.classList.remove("opacity-100", "scale-100", "translate-y-0", "pointer-events-auto");
    // Animate X back to hamburger
    hamburgerTop?.setAttribute("d", "M4 6h16");
    hamburgerMiddle?.classList.remove("opacity-0");
    hamburgerBottom?.setAttribute("d", "M4 18h16");
  }

  if (hamburgerButton && mobileMenu && mobileSearch) {
    hamburgerButton.addEventListener("click", () => {
      if (isOpen) {
        closeMenu();
      } else {
        openMenu();
      }
    });

    // Close menu when clicking outside
    document.addEventListener("click", (event) => {
      if (
        !hamburgerButton.contains(event.target as Node) &&
        !mobileMenu.contains(event.target as Node)
      ) {
        closeMenu();
      }
    });

    // Handle mobile search click
    mobileSearch.addEventListener("click", () => {
      const searchButton = document.getElementById("magnifying-glass");
      if (searchButton) {
        searchButton.click();
      }
      closeMenu();
    });

    // Close on escape key
    document.addEventListener("keydown", (event) => {
      if (event.key === "Escape" && isOpen) {
        closeMenu();
      }
    });
  }
</script> 